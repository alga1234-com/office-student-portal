<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OASIS Student Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/index.css">
  <style>
    /* Quick styling for demonstration, consider moving to index.css */
    .navbar { 
      background: navy;
      border-bottom: 1px solid #e5e7eb;
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      padding: 1rem 2vw;
    }
    .navbar-logo { 
      font-size: 1.55rem; 
      font-weight: 700; 
      color: #fff; /* White text for logo */
      letter-spacing: 2px; 
      text-decoration: none;
      display: flex;
      align-items: center;
    }
    .navbar-logo span {
      font-size: 12px;
      font-weight: 400;
      color: #f5f5f5 !important; /* Match profile page text */
      margin-left: 4px;
    }
    .navbar-menu { 
      display: flex; 
      gap: 2rem; 
      align-items: center;
    }
    .navbar-menu a, .nav-link {
      text-decoration: none; 
      color: #e1e0da; /* Match profile page text */
      font-size: 1rem; 
      font-weight: 500; 
      transition: color 0.18s, background 0.18s;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      display: inline-block;
    }
    .navbar-menu a:hover,
    .nav-link:hover {
      background: #546f81;
      color: #fff;
    }
    .navbar-actions { 
      display: flex; 
      gap: 0.7rem; 
    }
    .core-btn { 
      background: #22c55e; 
      color: #fff; 
      border: none; 
      border-radius: 999px; 
      padding: 0.55em 1.4em; 
      font-size: 1.03rem; 
      font-weight: 600; 
      cursor: pointer; 
      transition: background 0.18s; 
    }
    .core-btn:hover { background: #15803d; }
    .nav-orange { 
      background: #f97316; 
      color: #fff; 
      border: none; 
      border-radius: 999px; 
      padding: 0.45em 1.2em; 
      font-size: 1rem; 
      font-weight: 600; 
      cursor: pointer; 
      margin-left: 0.2em; 
      transition: background 0.18s; 
      text-decoration: none; 
      display: inline-block; 
    }
    .nav-orange:hover { background: #ea580c; }
    .navbar-profile {
      display: flex; align-items: center; margin-left: 1.2em;
    }
    .navbar-profile a {
      padding: 0;
      background: none;
      border: none;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      block-size: 48px;
    }
    .navbar-profile .profile-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: #15803d;
      font-weight: bold;
    }
    .hero { 
      display: flex; flex-direction: column; align-items: center; justify-content: center; 
      padding: 2.5rem 1.5rem 2rem 1.5rem; 
      background: #f1f5f9; min-block-size: 40vh; text-align: center; 
    }
    .hero-title { font-size: 2.2rem; font-weight: 700; color: #15803d; margin-block-end: 1rem; }
    .hero-desc { font-size: 1.17rem; color: #374151; margin-block-end: 2.2rem; max-width: 600px; }
    #loginFormSection { background: #fff; margin: 2rem auto 0 auto; padding: 1.5rem 2rem; border-radius: 14px; box-shadow: 0 2px 16px #0002; max-width: 370px; }
    #login-msg { margin-block-start: 1em; color: #d97706; min-block-size: 1.8em; }
    #loginFormSection input { width: 100%; margin-block-end: 1em; padding: 0.55em; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1em; }
    #loginFormSection button { width: 100%; margin-block-end: 0.5em; }
    #loginFormSection .section-title { font-size: 1.15rem; font-weight: 600; color: #15803d; margin-bottom: 1em; }
    @media (max-width: 600px) { 
      .navbar-menu { display: none; } 
      .hero { padding-block-start: 1.2rem; padding-block-end: 1.2rem; } 
      #loginFormSection { padding: 1.1rem; } 
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <a href="/" class="navbar-logo">
      OASIS <b><span>Student Portal</span></b>
    </a>
    <div class="navbar-menu">
      <nav class="nav-horizontal">
        <ul style="list-style: none; margin: 0; padding: 0; display: flex; gap: 1.2em;">
          <li><a href="help.html" class="nav-link">Help Desk</a></li>
        </ul>
      </nav>
    </div>
    <!-- Profile Avatar - fully clickable -->
    <div class="navbar-profile">
      <a href="profile.html" title="My Profile">
        <div class="profile-avatar" id="profileAvatarNavbar">A</div>
      </a>
    </div>
    <div class="navbar-actions">
      <a href="Login.html" class="nav-orange">Login</a>
    </div>
  </nav>
  <!-- Hero -->
  <section class="hero">
    <h1 class="hero-title">Welcome to OASIS Student Portal</h1>
    <p class="hero-desc">
      Your academic journey starts here. Log in with your email and OTP for secure access.<br>
      New user? <a href="signup.html" style="color:#22c55e;text-decoration:underline;">Sign up for free</a>!
    </p>
  </section>
  <!-- Login Form Section -->
  <section>
    <script>
    // Simple OTP Login Logic for the Front Page
    let loginEmail = '';

    document.getElementById('loginRequestOtpBtn').onclick = function () {
      loginEmail = document.getElementById('login-email').value.trim();
      if (!loginEmail) {
        document.getElementById('login-msg').textContent = "Please enter your email.";
        return;
      }
      fetch('/api/auth/request-login-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: loginEmail })
      })
      .then(res => res.json())
      .then(res => {
        if (res.success) {
          document.getElementById('loginRequestSection').style.display = 'none';
          document.getElementById('loginOtpSection').style.display = 'block';
          document.getElementById('login-msg').textContent = "OTP sent to your email.";
        } else {
          document.getElementById('login-msg').textContent = res.message || "Failed to send OTP.";
        }
      });
    };

    document.getElementById('loginOtpBtn').onclick = function () {
      const otp = document.getElementById('login-otp').value.trim();
      if (!otp) {
        document.getElementById('login-msg').textContent = "Please enter the OTP.";
        return;
      }
      fetch('/api/auth/login-with-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: loginEmail, otp })
      })
      .then(res => res.json())
      .then(res => {
        if (res.mustChange) {
          document.getElementById('login-msg').textContent = "First login: Please set a new password from the link sent to your email.";
          // Optionally, redirect or handle forced password change flow here
        } else if (res.token && res.user) {
          localStorage.setItem('oasisAuth', JSON.stringify({ user: res.user, token: res.token }));
          window.location.href = "dashboard.html";
        } else {
          document.getElementById('login-msg').textContent = res.message || "Invalid OTP.";
        }
      });
    };

    document.getElementById('loginResendBtn').onclick = function () {
      if (!loginEmail) {
        document.getElementById('login-msg').textContent = "Please enter your email above first.";
        return;
      }
      fetch('/api/auth/request-login-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: loginEmail })
      })
      .then(res => res.json())
      .then(res => {
        document.getElementById('login-msg').textContent = res.success ? "OTP resent!" : (res.message || "Failed to resend OTP.");
      });
    };
  </script>
<script src="script.js"></script>
</body>
</html>